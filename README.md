# CoStream## IntroductionCoStream is based on a novel hybrid stream join model, **CoModel**, which combines the advantages of the current state-of-the-art models by dividing the cluster into two parts and organizing each part as a matrix-like model. CoModel is able to effectively reduce the amount of computation for stream joins, which in turn allows for lower latency and higher throughput when storage resources are sufficient. CoStream adds adaptive features to CoModel to adapt to the input rate and memory footprint, allowing the system to get the lowest latency and highest throughput possible while not exceeding the memory upper limit.## RequirementsCoStream is built on top of Flink, a distributed stream processing engine.Meanwhile, CoStream adopts Zookeeper for inter-component communication and adopts Kafka as an adapter for data input and output.Therefore, before running CoStream, please make sure that the following software is installed in your cluster:- **jdk 1.8**- **flink 1.11**- **kafka 0.11**- **zookeeper 3.4.10**In addition, in order to run CoStream, there should be at least 64 `slots` in your `Flink` cluster.## ConfigurationsSome parameters in CoStream need to be configured before running CoStream.- Set the address of `Zookeeper` in `common.GeneralParameters` via `CONNECT_STRING`- Set the address of `Kafka` in `common.GeneralParameters` via `KAFKA_BROKER_LIST`In addition, some other experimental parameters can be configured in `common.GeneralParameters`, `coModel.CoModelParameters`, and `coModel.adaptive.CoModelParameterWithAdaptive`, such as parallelism and memory footprint upper limits.## Run CoStream- **Step 1**: Use `maven` to package the CoStream code as `CoStreamWithAdaptive-1.0-SNAPSHOT.jar`.- **Step 2**: Start Zookeeper and Kafka.- **Step 3**: Create Kafka topics for data input and output with the following commands:	- `bin/kafka-topics.sh --zookeeper <zookeeper address>  --create --replication-factor 1 --partitions 3 --topic FirstInputTestTopicV1`	- `bin/kafka-topics.sh --zookeeper <zookeeper address>  --create --replication-factor 1 --partitions 3 --topic SecondInputTestTopicV1`	- `bin/kafka-topics.sh --zookeeper <zookeeper address>  --create --replication-factor 1 --partitions 3 --topic TestLatencyResultTopicV1`- **Step 4**: Start Flink Cluster by running `flink/bin/start-cluster.sh` on the master node.- **Step 5**: Commit CoStream to the Flink cluster and execute it with the following command:	- `/bin/flink run -c coModel.adaptive.experiment.CoModelWithAdaptiveExpForNEXMark CoStreamWithAdaptive-1.0-SNAPSHOT.jar --rCopyNum 4 --sCopyNum 4 --R_surpass_S 0 --R_behind_S 0`	- Parameters are described as follows:		- _-c_ : The name of the main class to run.		- _--rCopyNum_, _--sCopyNum_ : The initial replica number of each of the two input streams.		- _--R\_surpass\_S_, _--R\_behind\_S_ : Range of the stream join.- **Step 6**: Write data to Topic `FirstInputTestTopicV1` and Topic `SecondInputTestTopicV1` of Kafka respectively, the data written is a string in the following format:	- <_Data source number_\>,<_Key_\>,<_Timestamp_\>,<_Tuple_\>## Results collectionThe processing results of CoStream are output to topic `TestLatencyResultTopicV1` of Kafka, where each record represents the statistics of the output results per second for each Joiner in CoStream, in the following format:- <_Number of results_\>, <_Average latency_\>, <_Start time_\>, <_End time_\>In addition, informations such as the real-time memory footprint of the stored tuples of the system are printed in the logs of CoStream.